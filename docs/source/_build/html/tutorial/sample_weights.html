<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sample weight adjustment &#8212; samplics 0.3.5 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/_source/samplics_style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/samplics_style.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Replicate weights" href="replicate_weights.html" />
    <link rel="prev" title="Selection of secondary sampling units (SSUs)" href="ssu_selection.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Sample Analytics</a>
        <span class="navbar-text navbar-version pull-left"><b>0.3.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../gettingstarted.html">Getting started</a></li>
                <li><a href="index.html">Tutorial</a></li>
                <li><a href="https://github.com/survey-methods/samplics">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">How to get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#datasets-for-the-tutorial">Datasets for the tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-size-calculation">Sample size calculation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sample_size_calculation.html">Sample size calculation for stage sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-selection">Sample selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="psu_selection.html">Selection of primary sampling units (PSUs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssu_selection.html">Selection of secondary sampling units (SSUs)</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#sample-weighting">Sample weighting</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Sample weight adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="replicate_weights.html">Replicate weights</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#population-parameters-estimation">Population parameters estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="estimation.html">Estimation of population parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#categorical-data-analysis">Categorical data analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tabulation.html">Tabulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="ttest.html">T-test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#small-area-estimation-sae">Small Area Estimation (SAE)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eblup_area_model.html">Area level model: empirical best linear unbiased predictor (EBLUP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="eblup_unit_model.html">Unit level model: empirical best linear unbiased Prediction (EBLUP)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../samplics.sampling.html">Sampling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sampling.html#module-samplics.sampling.selection">samplics.sampling.selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.weighting.html">Weighting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.weighting.html#module-samplics.weighting.adjustment">samplics.weighting.adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.weighting.html#module-samplics.weighting.replicates">samplics.weighting.replicates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.estimation.html">Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.expansion">samplics.estimation.expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.regression">samplics.estimation.regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.replication">samplics.estimation.replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.sae.html">Small Area Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sae.html#samplics-sae-eb-area-model">samplics.sae.eb_area_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sae.html#module-samplics.sae.eb_unit_model">samplics.sae.eb_unit_model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.utils.html">Utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.checks">samplics.utils.checks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.formats">samplics.utils.formats module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.hadamard">samplics.utils.hadamard module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Sample-weight-adjustment">
<h1>Sample weight adjustment<a class="headerlink" href="#Sample-weight-adjustment" title="Permalink to this headline">¶</a></h1>
<p>The objective of this tutorial is to familiarize ourselves with <em>SampleWeight</em> the <em>samplics</em> class for adjusting sample weights. In practice, it is necessary to adjust base or design sample weights obtained directly from the random sample mechanism. These adjustments are done to correct for nonresponse, reduce effects of extreme/large weights, better align with known auxiliary information, and more. Specifically in this tutorial, we will: * learn how to use the method <em>adjust()</em> to
redistribute sample weights to account for nonresponse and unknown eligibility, * learn how to use the method <em>poststratify()</em> to ensure that the sample weights sum to known control totals or that the relative distribution of domains is force to known distributions, * learn how to use the method <em>calibrate()</em> to adjust sample weight using auxiliary information under the regression model, * learn how to use the method <em>normalize()</em> to ensure that the sample weights sum to known constants.</p>
<p>To run the code in this notebook, we will use the dataset that was developed in the previous tutorial on sample selection.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">samplics</span>
<span class="kn">from</span> <span class="nn">samplics.datasets</span> <span class="kn">import</span> <span class="n">PSUSample</span><span class="p">,</span> <span class="n">SSUSample</span>
<span class="kn">from</span> <span class="nn">samplics.weighting</span> <span class="kn">import</span> <span class="n">SampleWeight</span>
</pre></div>
</div>
</div>
<div class="section" id="Design-(base)-weight">
<h2>Design (base) weight<a class="headerlink" href="#Design-(base)-weight" title="Permalink to this headline">¶</a></h2>
<p>The design weight is the inverse of the overall probability of selection which is the product of the first and second probabilities of selection.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load PSU sample data</span>
<span class="n">psu_sample_cls</span> <span class="o">=</span> <span class="n">PSUSample</span><span class="p">()</span>
<span class="n">psu_sample_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">psu_sample</span> <span class="o">=</span> <span class="n">psu_sample_cls</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># Load PSU sample data</span>
<span class="n">ssu_sample_cls</span> <span class="o">=</span> <span class="n">SSUSample</span><span class="p">()</span>
<span class="n">ssu_sample_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">ssu_sample</span> <span class="o">=</span> <span class="n">ssu_sample_cls</span><span class="o">.</span><span class="n">data</span>

<span class="n">full_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">psu_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;psu_prob&quot;</span><span class="p">]],</span>
    <span class="n">ssu_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;ssu_prob&quot;</span><span class="p">]],</span>
    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;inclusion_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;psu_prob&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ssu_prob&quot;</span><span class="p">]</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;design_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;inclusion_prob&quot;</span><span class="p">]</span>

<span class="n">full_sample</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>psu_prob</th>
      <th>household</th>
      <th>ssu_prob</th>
      <th>inclusion_prob</th>
      <th>design_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>72</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>73</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>75</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>715</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>722</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>724</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>755</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>761</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>764</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>782</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>10</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>795</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>7111</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>12</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>7112</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>7117</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>14</th>
      <td>7</td>
      <td>North</td>
      <td>0.187726</td>
      <td>7123</td>
      <td>0.115385</td>
      <td>0.021661</td>
      <td>46.166667</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For the purposes of this illustration of handling non-response, we first need to incorporate some household non-response into our example. That is, we simulate the non-response status and store it in the variable <em>response_status</em>. The variable <em>response_status</em> has four possible values: <em>ineligible</em> which indicates that the sampling unit is not eligible for the survey, <em>respondent</em> which indicates that the sampling unit responded to the survey, <em>non-respondent</em> which indicates that the sampling
unit did not respond to the survey, and <em>unknown</em> means that we are not able to infer the status of the sampling unit i.e. we do not know whether the sampling unit is eligible or not to the survey.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;ineligible&quot;</span><span class="p">,</span> <span class="s2">&quot;respondent&quot;</span><span class="p">,</span> <span class="s2">&quot;non-respondent&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="n">full_sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;design_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;response_status&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>design_weight</th>
      <th>response_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>ineligible</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>ineligible</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>10</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>non-respondent</td>
    </tr>
    <tr>
      <th>12</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>ineligible</td>
    </tr>
    <tr>
      <th>14</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Nonresponse-adjustment">
<h2>Nonresponse adjustment<a class="headerlink" href="#Nonresponse-adjustment" title="Permalink to this headline">¶</a></h2>
<p>In general, the sample weights are adjusted to redistribute the sample weights of all eligible units for which there is no sufficient response (unit level nonresponse) to the sampling units that sufficiently responded to the survey. This adjustment is done within adjustment classes or domains. Note that the determination of the response categories (unit response, item response, ineligible, etc.) is outside of the scope of this tutorial.</p>
<p>Also, the weights of the sampling units with unknown eligibility are redistributed to the rest of the sampling units. In general, ineligible sampling units receive weights from the sampling units with unknown eligibility since eligible sampling units can be part of the unknown pool.</p>
<p>The method <em>adjust()</em> has a boolean parameter <em>unknown_to_inelig</em> which controls how the sample weights of the unknown is redistributed. By default, <em>adjust()</em> redistribute the sample weights of the sampling units of the unknown to the ineligibles (<em>unknown_to_inelig=True</em>). If we do not wish to redistribute the sample weights of the unknowns to the ineligibles then we just set the flag to False (<em>unknown_to_inelig=Fasle</em>).</p>
<p>In the snippet of code below, we adjust the weight within clusters that is we use clusters as our adjustment classes. Note that we run the nonresponse adjustment twice, the first time with <em>unknown_to_inelig=True</em> (<em>nr_weight</em>) and the second time with the flag equal to False (<em>nr_weight2</em>). With <em>unknown_to_inelig=True</em>, the ineligible received part of the sample weights from the unknowns. Hence, the sample weights for the respondent is less than when the flag is False. With
<em>unknown_to_inelig=Fasle</em>, the ineligible did Not receive any weights from the unknowns. Hence, the sample weights for the ineligible units remain the same before and after adjustment. In a real survey, the statistician may decide on the best non-response strategy based on the available information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="s2">&quot;ineligible&quot;</span><span class="p">,</span> <span class="s2">&quot;rr&quot;</span><span class="p">:</span> <span class="s2">&quot;respondent&quot;</span><span class="p">,</span> <span class="s2">&quot;nr&quot;</span><span class="p">:</span> <span class="s2">&quot;non-respondent&quot;</span><span class="p">,</span> <span class="s2">&quot;uk&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;design_weight&quot;</span><span class="p">],</span>
    <span class="n">adjust_class</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]],</span>
    <span class="n">resp_status</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">],</span>
    <span class="n">resp_dict</span><span class="o">=</span><span class="n">status_mapping</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;design_weight&quot;</span><span class="p">],</span>
    <span class="n">adjust_class</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]],</span>
    <span class="n">resp_status</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">],</span>
    <span class="n">resp_dict</span><span class="o">=</span><span class="n">status_mapping</span><span class="p">,</span>
    <span class="n">unknown_to_inelig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;design_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;response_status&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight2&quot;</span><span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>design_weight</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>nr_weight2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>46.166667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>55.400000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>46.166667</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10</td>
      <td>North</td>
      <td>50.783333</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>10</td>
      <td>North</td>
      <td>50.783333</td>
      <td>respondent</td>
      <td>70.733929</td>
      <td>71.096667</td>
    </tr>
    <tr>
      <th>19</th>
      <td>10</td>
      <td>North</td>
      <td>50.783333</td>
      <td>ineligible</td>
      <td>54.410714</td>
      <td>50.783333</td>
    </tr>
    <tr>
      <th>21</th>
      <td>10</td>
      <td>North</td>
      <td>50.783333</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>30</th>
      <td>16</td>
      <td>South</td>
      <td>62.149123</td>
      <td>respondent</td>
      <td>66.588346</td>
      <td>66.588346</td>
    </tr>
    <tr>
      <th>35</th>
      <td>16</td>
      <td>South</td>
      <td>62.149123</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>45</th>
      <td>24</td>
      <td>South</td>
      <td>58.940741</td>
      <td>respondent</td>
      <td>63.852469</td>
      <td>63.852469</td>
    </tr>
    <tr>
      <th>47</th>
      <td>24</td>
      <td>South</td>
      <td>58.940741</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>55</th>
      <td>24</td>
      <td>South</td>
      <td>58.940741</td>
      <td>ineligible</td>
      <td>58.940741</td>
      <td>58.940741</td>
    </tr>
    <tr>
      <th>60</th>
      <td>29</td>
      <td>South</td>
      <td>65.702778</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>61</th>
      <td>29</td>
      <td>South</td>
      <td>65.702778</td>
      <td>respondent</td>
      <td>101.081197</td>
      <td>102.204321</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Important.</strong> The default call of <em>adjust()</em> expects standard codes for response status that is “in”, “rr”, “nr”, and “uk” where “in” means ineligible, “rr” means respondent, “nr” means non-respondent, and “uk” means unknown eligibility.</p>
<p>In the call above, if we omit the parameter <em>response_dict</em>, then the run would fail with an assertion error message. The current error message is the following: <strong>The response status must only contains values in (‘in’, ‘rr’, ‘nr’, ‘uk’) or the mapping should be provided using response_dict parameter</strong>. For the call to run without using <em>response_dict</em>, it is necessary that the response status takes only values in the standard codes i.e. (“in”, “rr”, “nr”, “uk”). The variable associated with
<em>response_status</em> can contain any code but a mapping is necessary when the response variable is not constructed using the standard codes.</p>
<p>To further illustrate the mapping of response status, let’s assume that we have response_status2 which has the values 100 for ineligible, 200 for non-respondent, 300 for respondent, and 999 for unknown.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">response_status2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">response_status2</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;non-respondent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">response_status2</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;respondent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">response_status2</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>

<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">response_status2</span><span class="p">,</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response_status</th>
      <th>ineligible</th>
      <th>non-respondent</th>
      <th>respondent</th>
      <th>unknown</th>
    </tr>
    <tr>
      <th>row_0</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100</th>
      <td>16</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>300</th>
      <td>0</td>
      <td>0</td>
      <td>106</td>
      <td>0</td>
    </tr>
    <tr>
      <th>999</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>To use <em>response_status2</em>, we need to map the values 100, 200, 300 and 999 to “in”, “rr”, “nr”, and “uk”. This mapping is done below using the Python dictionary <em>status_mapping2</em>. Using <em>status_mapping2</em> in the function call <em>adjust()</em> will lead to the same adjustment as in the previous run i.e. <em>nr_weight</em> and <em>nr_weight3</em> contain the same adjusted weights.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">status_mapping2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;nr&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;rr&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;uk&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;design_weight&quot;</span><span class="p">],</span>
    <span class="n">adjust_class</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]],</span>
    <span class="n">resp_status</span><span class="o">=</span><span class="n">response_status2</span><span class="p">,</span>
    <span class="n">resp_dict</span><span class="o">=</span><span class="n">status_mapping2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;response_status&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight3&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/msdiallo/.pyenv/versions/3.9.4/lib/python3.9/site-packages/numpy/lib/arraysetops.py:583: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  mask |= (ar1 == a)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>nr_weight3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>49.464286</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>54.410714</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10</td>
      <td>North</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If the response status variable only takes values “in”, “nr”, “rr” and “uk”, then it is not necessary to provide the mapping dictionary to the function i.e. <em>resp_dict</em> can be omitted from the function call <em>adjust()</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">response_status3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">response_status3</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;non-respondent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nr&quot;</span>
<span class="n">response_status3</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;respondent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;rr&quot;</span>
<span class="n">response_status3</span><span class="p">[</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;response_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;uk&quot;</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;design_weight&quot;</span><span class="p">],</span>
    <span class="n">adjust_class</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">]],</span>
    <span class="n">resp_status</span><span class="o">=</span><span class="n">response_status3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;response_status&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight4&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>nr_weight4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>49.464286</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>54.410714</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10</td>
      <td>North</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Just dropping a couple of variables not needed for the rest of the tutorial</span>
<span class="n">full_sample</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;psu_prob&quot;</span><span class="p">,</span> <span class="s2">&quot;ssu_prob&quot;</span><span class="p">,</span> <span class="s2">&quot;inclusion_prob&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight2&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight3&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight4&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Poststratification">
<h2>Poststratification<a class="headerlink" href="#Poststratification" title="Permalink to this headline">¶</a></h2>
<p>Poststratification is useful to compensate for under-representation of the sample or to correct for nonsampling error. The most common poststratification method consists of adjusting the sample weights to ensure that they sum to <strong>known</strong> control values from <strong>reliable</strong> souces by adjustment classes (domains). Poststratification classes can be formed using variables beyond the ones involved in the sampling design. For example, socio-economic variables such as age group, gender, race and
education are often used to form poststratification classes/cells.</p>
<p><strong>Important:</strong> poststratifying to totals that are known to be out of date, and thus likely inaccurate and unreliable will not improve the estimate. Use this with caution.</p>
<p>Let’s assume that we have a reliable external source e.g. a recent census that provides the number of households by region. The external source has the following control data: 3700 households for East, 1500 for North, 2800 for South and 6500 for West.</p>
<p>We use the method <em>poststratify()</em> to ensure that the poststratified sample weights (<em>ps_weight</em>) sum to the know control totals by region. Note that the control totals are provided using the Python dictionary <em>census_households</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">census_households</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;East&quot;</span><span class="p">:</span> <span class="mi">3700</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">:</span> <span class="mi">2800</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">:</span> <span class="mi">6500</span><span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ps_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">poststratify</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span>
    <span class="n">control</span><span class="o">=</span><span class="n">census_households</span><span class="p">,</span>
    <span class="n">domain</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>household</th>
      <th>design_weight</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>ps_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>72</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>51.020408</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>73</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>75</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>715</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>722</td>
      <td>46.166667</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>North</td>
      <td>724</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>North</td>
      <td>755</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>North</td>
      <td>761</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>51.020408</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>North</td>
      <td>764</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>North</td>
      <td>782</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>10</th>
      <td>7</td>
      <td>North</td>
      <td>795</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>7111</td>
      <td>46.166667</td>
      <td>non-respondent</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>7</td>
      <td>North</td>
      <td>7112</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>North</td>
      <td>7117</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>51.020408</td>
    </tr>
    <tr>
      <th>14</th>
      <td>7</td>
      <td>North</td>
      <td>7123</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The snippet of code below shows that the poststratified sample weights sum to the expected control totals that is 3700 households for East, 1500 for North, 2800 for South and 6500 for West.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sum_of_weights</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;ps_weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sum_of_weights</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sum_of_weights</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>nr_weight</th>
      <th>ps_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>East</td>
      <td>3698.703391</td>
      <td>3700.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>North</td>
      <td>1454.250000</td>
      <td>1500.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>South</td>
      <td>2801.889620</td>
      <td>2800.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>West</td>
      <td>6485.783333</td>
      <td>6500.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The crosstable below shows that only one adjustment factor was calculated and applied per adjustment class or region.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ps_adjust_fct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ps_weight&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="mi">12</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ps_adjust_fct&quot;</span><span class="p">],</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>region</th>
      <th>East</th>
      <th>North</th>
      <th>South</th>
      <th>West</th>
    </tr>
    <tr>
      <th>ps_adjust_fct</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.999326</th>
      <td>0</td>
      <td>0</td>
      <td>38</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.000351</th>
      <td>37</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.002192</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>23</td>
    </tr>
    <tr>
      <th>1.031460</th>
      <td>0</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>In some surveys, there is interest in keeping relative distribution of strata to some known distribution. For example, WHO EPI vaccination surveys often postratify sample weights to ensure that relative sizes of strata reflect offcial statistics e.g. census data. In most cases, the strata are based on some administrative divisions.</p>
<p>For example, assume that according to census data that East contains 25% of the households, North contains 10%, South contains 20% and West contains 45%. We can poststratify using the snippet of code below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">known_ratios</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;East&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">}</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;ps_weight2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">poststratify</span><span class="p">(</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="n">factor</span><span class="o">=</span><span class="n">known_ratios</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>household</th>
      <th>design_weight</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>ps_weight</th>
      <th>ps_adjust_fct</th>
      <th>ps_weight2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>72</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>51.020408</td>
      <td>1.03146</td>
      <td>49.117777</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>73</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>75</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>715</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>722</td>
      <td>46.166667</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sum_of_weights2</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;ps_weight2&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sum_of_weights2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sum_of_weights2</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_of_weights2</span><span class="p">[</span><span class="s2">&quot;ps_weight2&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sum_of_weights2</span><span class="p">[</span><span class="s2">&quot;ps_weight2&quot;</span><span class="p">])</span>
<span class="n">sum_of_weights2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>nr_weight</th>
      <th>ps_weight2</th>
      <th>ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>East</td>
      <td>3698.703391</td>
      <td>3610.156586</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>North</td>
      <td>1454.250000</td>
      <td>1444.062634</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>South</td>
      <td>2801.889620</td>
      <td>2888.125269</td>
      <td>0.20</td>
    </tr>
    <tr>
      <th>3</th>
      <td>West</td>
      <td>6485.783333</td>
      <td>6498.281855</td>
      <td>0.45</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Calibration">
<h2>Calibration<a class="headerlink" href="#Calibration" title="Permalink to this headline">¶</a></h2>
<p>Calibration is a more general concept for adjusting sample weights to sum to known constants. In this tutorial, we consider the generalized regression (GREG) class of calibration. Assume that we have <span class="math notranslate nohighlight">\(\hat{\mathbf{Y}} = \sum_{i \in s} w_i y_i\)</span> and know population totals <span class="math notranslate nohighlight">\(\mathbf{X} = (\mathbf{X}_1, ..., \mathbf{X}_p)^T\)</span> are available. Working under the model <span class="math notranslate nohighlight">\(Y_i | \mathbf{x}_i = \mathbf{x}^T_i \mathbf{\beta} + \epsilon_i\)</span>, the GREG estimator of the population total is</p>
<div class="math notranslate nohighlight">
\[\hat{\mathbf{Y}}_{GR} = \hat{\mathbf{Y}} + (\mathbf{X} - \hat{\mathbf{X}})^T\hat{\mathbf{B}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\mathbf{B}}\)</span> is the weighted least squares estimate of <span class="math notranslate nohighlight">\(\mathbf{\beta}\)</span> and <span class="math notranslate nohighlight">\(\hat{\mathbf{X}}\)</span> is the survey estimate of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>. The essential of the GREG approach is, under the regression model, to find the adjusted weights <span class="math notranslate nohighlight">\(w^{*}_i\)</span> that are the closest to <span class="math notranslate nohighlight">\(w_i\)</span>, to minimize <span class="math notranslate nohighlight">\(h(z) = \frac{\sum_{i \in s} c_i(w_i - z_i)}{w_i}\)</span>.</p>
<p>Let us simulate three auxiliary variables that is education, poverty and under_five (number of children under five in the household) and assume that we have the following control totals. * Total number of under five children: 6300 in the East, 4000 in the North, 6500 in the South and 14000 in the West. * Poverty (Yes: in poverty / No: not in poverty)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">Region</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">|</span> <span class="n">Poverty</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">|</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">households</span> <span class="o">|</span>
<span class="o">|</span><span class="p">:</span><span class="o">--------|</span><span class="p">:</span><span class="o">--------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">--------------------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span> <span class="n">East</span>    <span class="o">|</span>    <span class="n">No</span>    <span class="o">|</span>       <span class="mi">2600</span>           <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>    <span class="n">Yes</span>   <span class="o">|</span>       <span class="mi">1200</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">North</span>   <span class="o">|</span>    <span class="n">No</span>    <span class="o">|</span>       <span class="mi">1500</span>           <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>    <span class="n">Yes</span>   <span class="o">|</span>        <span class="mi">200</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">South</span>   <span class="o">|</span>    <span class="n">No</span>    <span class="o">|</span>       <span class="mi">1800</span>           <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>    <span class="n">Yes</span>   <span class="o">|</span>       <span class="mi">1100</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">West</span>    <span class="o">|</span>    <span class="n">No</span>    <span class="o">|</span>       <span class="mi">4500</span>           <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>    <span class="n">Yes</span>   <span class="o">|</span>       <span class="mi">2200</span>           <span class="o">|</span>
</pre></div>
</div>
<ul>
<li><p>Education (Low: less than secondary, Medium: secondary completed, and High: More than secondary)</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 28%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Region</p></th>
<th class="head"><p>Education</p></th>
<th class="head"><p>Number of households</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>East</p></td>
<td><p>Low</p></td>
<td><p>2000</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Medium</p></td>
<td><p>1400</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>High</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>North</p></td>
<td><p>Low</p></td>
<td><p>550</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>Medium</p></td>
<td><p>700</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>High</p></td>
<td><p>250</p></td>
</tr>
<tr class="row-even"><td><p>South</p></td>
<td><p>Low</p></td>
<td><p>1300</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Medium</p></td>
<td><p>1200</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>High</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>West</p></td>
<td><p>Low</p></td>
<td><p>2100</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>Medium</p></td>
<td><p>4000</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>High</p></td>
<td><p>500</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">))</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;poverty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;under_five&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))</span>
<span class="n">full_sample</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>household</th>
      <th>design_weight</th>
      <th>response_status</th>
      <th>nr_weight</th>
      <th>ps_weight</th>
      <th>ps_adjust_fct</th>
      <th>ps_weight2</th>
      <th>education</th>
      <th>poverty</th>
      <th>under_five</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>72</td>
      <td>46.166667</td>
      <td>ineligible</td>
      <td>49.464286</td>
      <td>51.020408</td>
      <td>1.03146</td>
      <td>49.117777</td>
      <td>High</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>73</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
      <td>Low</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>75</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
      <td>Medium</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>715</td>
      <td>46.166667</td>
      <td>respondent</td>
      <td>54.410714</td>
      <td>56.122449</td>
      <td>1.03146</td>
      <td>54.029554</td>
      <td>Medium</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>722</td>
      <td>46.166667</td>
      <td>unknown</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>Medium</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We now will calibrate the nonreponse weight (<em>nr_weight</em>) to ensure that the estimated number of households in poverty is equal to 4,700 and the estimated total number of children under five is 30,8500. The control numbers 4,700 and 30,800 are obtained from the table above.</p>
<p>The class <em>SampleWeight()</em> uses the method <em>calibrate(samp_weight, aux_vars, control, domain, scale, bounded, modified)</em> to adjust the weight using the GREG approach. * The contol values must be stored in a python dictionnary i.e. totals = {“poverty”: 4700, “under_five”: 30800}. In this case, we have two numerical variables poverty with values in {0, 1} and under_five with values in {0, 1, 2, 3, 4, 5}. * <em>aux_vars</em> is the matrix of covariates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">totals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">4700</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">30800</span><span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;calib_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
    <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;poverty&quot;</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">]],</span> <span class="n">totals</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;calib_weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>household</th>
      <th>nr_weight</th>
      <th>calib_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>72</td>
      <td>49.464286</td>
      <td>50.432441</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>73</td>
      <td>54.410714</td>
      <td>57.233887</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>75</td>
      <td>54.410714</td>
      <td>56.292829</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>715</td>
      <td>54.410714</td>
      <td>56.416743</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>722</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>North</td>
      <td>724</td>
      <td>54.410714</td>
      <td>57.233887</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>North</td>
      <td>755</td>
      <td>54.410714</td>
      <td>57.233887</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>North</td>
      <td>761</td>
      <td>49.464286</td>
      <td>49.464286</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>North</td>
      <td>764</td>
      <td>54.410714</td>
      <td>56.292829</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>North</td>
      <td>782</td>
      <td>54.410714</td>
      <td>57.233887</td>
    </tr>
    <tr>
      <th>10</th>
      <td>7</td>
      <td>North</td>
      <td>795</td>
      <td>54.410714</td>
      <td>58.174944</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>7111</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>7</td>
      <td>North</td>
      <td>7112</td>
      <td>54.410714</td>
      <td>59.116002</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>North</td>
      <td>7117</td>
      <td>49.464286</td>
      <td>50.319793</td>
    </tr>
    <tr>
      <th>14</th>
      <td>7</td>
      <td>North</td>
      <td>7123</td>
      <td>54.410714</td>
      <td>56.292829</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can confirm that the estimated totals for the auxiliary variables are equal to their control values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">poverty</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;poverty&quot;</span><span class="p">]</span>
<span class="n">under_5</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;under_five&quot;</span><span class="p">]</span>
<span class="n">nr_weight</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">]</span>
<span class="n">calib_weight</span> <span class="o">=</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;calib_weight&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total estimated number of poor households was </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">poverty</span><span class="o">*</span><span class="n">nr_weight</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> before and </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">poverty</span><span class="o">*</span><span class="n">calib_weight</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> after adjustment </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Total estimated number of children under 5 was </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">under_5</span><span class="o">*</span><span class="n">nr_weight</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> before and </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">under_5</span><span class="o">*</span><span class="n">calib_weight</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> after adjustment </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Total estimated number of poor households was 4521.84 before and 4700.00 after adjustment

Total estimated number of children under 5 was 29442.52 before and 30800.00 after adjustment

</pre></div></div>
</div>
<p>If we want to control by domain then we can do so using the parameter <em>domain</em> of <em>calibrate()</em>. First we need to update the python dictionary holding the control values. Now, those values have to be provided for each domain. Note that the dictionary is now a nested dictionary where the higher level keys hold the domain values i.e. East, North, South and West. Then the higher level values of the dictionary are the dictionaries providing mapping for the auxiliary variables and the corresponding
control values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">totals_by_domain</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;East&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">6300</span><span class="p">},</span>
    <span class="s2">&quot;North&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">},</span>
    <span class="s2">&quot;South&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">1100</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">6500</span><span class="p">},</span>
    <span class="s2">&quot;West&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">2200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;calib_weight_d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
    <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span>
    <span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;poverty&quot;</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">]],</span>
    <span class="n">totals_by_domain</span><span class="p">,</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;calib_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;calib_weight_d&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cluster</th>
      <th>region</th>
      <th>household</th>
      <th>nr_weight</th>
      <th>calib_weight</th>
      <th>calib_weight_d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>North</td>
      <td>72</td>
      <td>49.464286</td>
      <td>50.432441</td>
      <td>40.892864</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>North</td>
      <td>73</td>
      <td>54.410714</td>
      <td>57.233887</td>
      <td>61.852139</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>North</td>
      <td>75</td>
      <td>54.410714</td>
      <td>56.292829</td>
      <td>59.371664</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7</td>
      <td>North</td>
      <td>715</td>
      <td>54.410714</td>
      <td>56.416743</td>
      <td>47.462625</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>North</td>
      <td>722</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>North</td>
      <td>724</td>
      <td>54.410714</td>
      <td>57.233887</td>
      <td>61.852139</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>North</td>
      <td>755</td>
      <td>54.410714</td>
      <td>57.233887</td>
      <td>61.852139</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>North</td>
      <td>761</td>
      <td>49.464286</td>
      <td>49.464286</td>
      <td>49.464286</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>North</td>
      <td>764</td>
      <td>54.410714</td>
      <td>56.292829</td>
      <td>59.371664</td>
    </tr>
    <tr>
      <th>9</th>
      <td>7</td>
      <td>North</td>
      <td>782</td>
      <td>54.410714</td>
      <td>57.233887</td>
      <td>61.852139</td>
    </tr>
    <tr>
      <th>10</th>
      <td>7</td>
      <td>North</td>
      <td>795</td>
      <td>54.410714</td>
      <td>58.174944</td>
      <td>64.332614</td>
    </tr>
    <tr>
      <th>11</th>
      <td>7</td>
      <td>North</td>
      <td>7111</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>7</td>
      <td>North</td>
      <td>7112</td>
      <td>54.410714</td>
      <td>59.116002</td>
      <td>66.813089</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>North</td>
      <td>7117</td>
      <td>49.464286</td>
      <td>50.319793</td>
      <td>51.719263</td>
    </tr>
    <tr>
      <th>14</th>
      <td>7</td>
      <td>North</td>
      <td>7123</td>
      <td>54.410714</td>
      <td>56.292829</td>
      <td>59.371664</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note that the GREG domain estimates above do not have the additive property. That is the GREG domain estimates do not sum to the overal GREG estimate. To illustrate this, let’s assume that we want to estimate the number of households.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The number of households using the overall GREG is: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s1">&#39;calib_weight&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The number of households using the domain GREG is: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s1">&#39;calib_weight_d&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The number of households using the overall GREG is: 14960.15

The number of households using the domain GREG is: 14959.01

</pre></div></div>
</div>
<p>Note that with the additive flag equal to True, the sum of the domain estimates is equal to the GREG overal estimate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">totals_by_domain</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;East&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">6300</span><span class="p">},</span>
    <span class="s2">&quot;North&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">},</span>
    <span class="s2">&quot;South&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">1100</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">6500</span><span class="p">},</span>
    <span class="s2">&quot;West&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;poverty&quot;</span><span class="p">:</span> <span class="mi">2200</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">calib_weight3</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span>
    <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span>
    <span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;poverty&quot;</span><span class="p">,</span> <span class="s2">&quot;under_five&quot;</span><span class="p">]],</span>
    <span class="n">totals_by_domain</span><span class="p">,</span>
    <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span>
    <span class="n">additive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">under_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;under_five&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Each column can be used to estimate a domain: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">calib_weight3</span><span class="p">)</span> <span class="o">*</span> <span class="n">under_5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The number of households using the overall GREG is: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s1">&#39;calib_weight&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The number of households using the domain GREG is: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s1">&#39;calib_weight_d&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - with ADDITIVE=FALSE</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The number of households using the domain GREG is: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">calib_weight3</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - with ADDITIVE=TRUE </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Each column can be used to estimate a domain: [ 6300.  4000.  6500. 14000.]

The number of households using the overall GREG is: 14960.15

The number of households using the domain GREG is: 14959.01 - with ADDITIVE=FALSE

The number of households using the domain GREG is: 14960.15 - with ADDITIVE=TRUE

</pre></div></div>
</div>
</div>
<div class="section" id="Normalization">
<h2>Normalization<a class="headerlink" href="#Normalization" title="Permalink to this headline">¶</a></h2>
<p>DHS and MICS normalize the final sample weights to sum to the sample size. We can use the class method <em>normalize()</em> to ensure that the sample weight sum to some constant across the sample or by normalization domain e.g. stratum.</p>
<p><strong>Important:</strong> <em>normalization</em> is mostly added here for completeness but it is sheldom to see sample weight normalize in large scale household surveys. One major downside of normalized weights is the Note that estimation of totals does not make sense with normalized weights.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">])</span>


<span class="n">full_sample</span><span class="p">[[</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

<span class="nb">print</span><span class="p">((</span><span class="n">full_sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(150, 150.0)
</pre></div></div>
</div>
<p>When <em>normalize()</em> is called with only the parameter <em>sample_weight</em> then the sample weights are normalize to sum to the length of the sample weight vector.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="n">control</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
300.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="n">domain</span><span class="o">=</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>

<span class="n">weight_sum</span> <span class="o">=</span> <span class="n">full_sample</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;region&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">weight_sum</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">weight_sum</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight3&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>nr_weight</th>
      <th>norm_weight</th>
      <th>norm_weight3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>East</td>
      <td>3698.703391</td>
      <td>38.419768</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>North</td>
      <td>1454.250000</td>
      <td>15.105820</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>South</td>
      <td>2801.889620</td>
      <td>29.104239</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>West</td>
      <td>6485.783333</td>
      <td>67.370173</td>
      <td>30.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">norm_level</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;East&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>

<span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;norm_weight4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SampleWeight</span><span class="p">()</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;nr_weight&quot;</span><span class="p">],</span> <span class="n">norm_level</span><span class="p">,</span> <span class="n">full_sample</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">])</span>

<span class="n">weight_sum</span> <span class="o">=</span> <span class="n">full_sample</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;region&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">weight_sum</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">weight_sum</span><span class="p">[[</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;nr_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight2&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight3&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_weight4&quot;</span><span class="p">,]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>nr_weight</th>
      <th>norm_weight</th>
      <th>norm_weight2</th>
      <th>norm_weight3</th>
      <th>norm_weight4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>East</td>
      <td>3698.703391</td>
      <td>38.419768</td>
      <td>76.839535</td>
      <td>45.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>North</td>
      <td>1454.250000</td>
      <td>15.105820</td>
      <td>30.211640</td>
      <td>30.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>South</td>
      <td>2801.889620</td>
      <td>29.104239</td>
      <td>58.208478</td>
      <td>45.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>West</td>
      <td>6485.783333</td>
      <td>67.370173</td>
      <td>134.740347</td>
      <td>30.0</td>
      <td>50.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019-2020, samplics.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>