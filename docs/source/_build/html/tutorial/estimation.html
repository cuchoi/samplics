<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Estimation of population parameters &#8212; samplics 0.3.5 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/_source/samplics_style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/samplics_style.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tabulation" href="tabulation.html" />
    <link rel="prev" title="Replicate weights" href="replicate_weights.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Sample Analytics</a>
        <span class="navbar-text navbar-version pull-left"><b>0.3.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../gettingstarted.html">Getting started</a></li>
                <li><a href="index.html">Tutorial</a></li>
                <li><a href="https://github.com/survey-methods/samplics">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">How to get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gettingstarted.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#datasets-for-the-tutorial">Datasets for the tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-size-calculation">Sample size calculation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sample_size_calculation.html">Sample size calculation for stage sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-selection">Sample selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="psu_selection.html">Selection of primary sampling units (PSUs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssu_selection.html">Selection of secondary sampling units (SSUs)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sample-weighting">Sample weighting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sample_weights.html">Sample weight adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="replicate_weights.html">Replicate weights</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#population-parameters-estimation">Population parameters estimation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Estimation of population parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#categorical-data-analysis">Categorical data analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tabulation.html">Tabulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="ttest.html">T-test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#small-area-estimation-sae">Small Area Estimation (SAE)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eblup_area_model.html">Area level model: empirical best linear unbiased predictor (EBLUP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="eblup_unit_model.html">Unit level model: empirical best linear unbiased Prediction (EBLUP)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usecases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../samplics.sampling.html">Sampling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sampling.html#module-samplics.sampling.selection">samplics.sampling.selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.weighting.html">Weighting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.weighting.html#module-samplics.weighting.adjustment">samplics.weighting.adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.weighting.html#module-samplics.weighting.replicates">samplics.weighting.replicates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.estimation.html">Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.expansion">samplics.estimation.expansion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.regression">samplics.estimation.regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.estimation.html#module-samplics.estimation.replication">samplics.estimation.replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.sae.html">Small Area Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sae.html#samplics-sae-eb-area-model">samplics.sae.eb_area_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.sae.html#module-samplics.sae.eb_unit_model">samplics.sae.eb_unit_model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../samplics.utils.html">Utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.checks">samplics.utils.checks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.formats">samplics.utils.formats module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../samplics.utils.html#module-samplics.utils.hadamard">samplics.utils.hadamard module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Estimation-of-population-parameters">
<h1>Estimation of population parameters<a class="headerlink" href="#Estimation-of-population-parameters" title="Permalink to this headline">¶</a></h1>
<p>The objective of this tutorial is illustrate the use of the <em>samplics</em> estimation APIs. There are two main classes: <em>TaylorEstimator</em> and <em>ReplicateEstimator</em>. The former class uses linearization methods to estimate variance of population parameters while the latter uses replicate-based methods (bootstrap, brr/fay, and jackknife) to estimate the variance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">samplics</span>
<span class="kn">from</span> <span class="nn">samplics.datasets</span> <span class="kn">import</span> <span class="n">Nhanes2</span><span class="p">,</span> <span class="n">Nhanes2brr</span><span class="p">,</span> <span class="n">Nhanes2jk</span><span class="p">,</span> <span class="n">Nmihs</span>
<span class="kn">from</span> <span class="nn">samplics.estimation</span> <span class="kn">import</span> <span class="n">TaylorEstimator</span><span class="p">,</span> <span class="n">ReplicateEstimator</span>
</pre></div>
</div>
</div>
<div class="section" id="Taylor-approximation">
<h2>Taylor approximation<a class="headerlink" href="#Taylor-approximation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load Nhanes sample data</span>
<span class="n">nhanes2_cls</span> <span class="o">=</span> <span class="n">Nhanes2</span><span class="p">()</span>
<span class="n">nhanes2_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">nhanes2</span> <span class="o">=</span> <span class="n">nhanes2_cls</span><span class="o">.</span><span class="n">data</span>

<span class="n">nhanes2</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>stratid</th>
      <th>psuid</th>
      <th>race</th>
      <th>highbp</th>
      <th>highlead</th>
      <th>zinc</th>
      <th>diabetes</th>
      <th>finalwgt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>104.0</td>
      <td>0.0</td>
      <td>8995</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>111.0</td>
      <td>0.0</td>
      <td>25964</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>NaN</td>
      <td>102.0</td>
      <td>0.0</td>
      <td>8752</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>109.0</td>
      <td>1.0</td>
      <td>4310</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>99.0</td>
      <td>0.0</td>
      <td>9011</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>101.0</td>
      <td>0.0</td>
      <td>4310</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>93.0</td>
      <td>0.0</td>
      <td>3201</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>83.0</td>
      <td>0.0</td>
      <td>25386</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>98.0</td>
      <td>0.0</td>
      <td>12102</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0.0</td>
      <td>98.0</td>
      <td>0.0</td>
      <td>4312</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>NaN</td>
      <td>92.0</td>
      <td>0.0</td>
      <td>4031</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0.0</td>
      <td>90.0</td>
      <td>0.0</td>
      <td>3628</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>101.0</td>
      <td>0.0</td>
      <td>28590</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>22754</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>1.0</td>
      <td>123.0</td>
      <td>0.0</td>
      <td>7119</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We calculate the survey mean of the level of zinc using Stata and we get the following</p>
<p>Using <em>samplics</em>, the same estimate can be obtained using the snippet of code below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">zinc_mean_str</span> <span class="o">=</span> <span class="n">TaylorEstimator</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">zinc_mean_str</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;zinc&quot;</span><span class="p">],</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span>
    <span class="n">stratum</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;stratid&quot;</span><span class="p">],</span>
    <span class="n">psu</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;psuid&quot;</span><span class="p">],</span>
    <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">zinc_mean_str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Mean

Number of strata: 31
Number of psus: 62
Degree of freedom: 31

     MEAN       SE       LCI       UCI       CV
87.182067 0.494483 86.173563 88.190571 0.005672
</pre></div></div>
</div>
<p>Let’s remove the stratum parameter then we get the following with stata</p>
<p>with samplics, we get …</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">zinc_mean_nostr</span> <span class="o">=</span> <span class="n">TaylorEstimator</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">zinc_mean_nostr</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;zinc&quot;</span><span class="p">],</span> <span class="n">samp_weight</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span> <span class="n">psu</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;psuid&quot;</span><span class="p">],</span> <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">zinc_mean_nostr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Mean

Number of strata: 1
Number of psus: 2
Degree of freedom: 1

     MEAN       SE       LCI       UCI       CV
87.182067 0.742622 77.746158 96.617976 0.008518
</pre></div></div>
</div>
<p>The other parameters currently implemented in <em>TaylorEstimator</em> are TOTAL, PROPORTION and RATIO. TOTAL and PROPORTION have the same function call as the MEAN parameter. For the RATIO parameter, it is necessary to provide the parameter <em>x</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ratio_bp_lead</span> <span class="o">=</span> <span class="n">TaylorEstimator</span><span class="p">(</span><span class="s2">&quot;ratio&quot;</span><span class="p">)</span>
<span class="n">ratio_bp_lead</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;highbp&quot;</span><span class="p">],</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;highlead&quot;</span><span class="p">],</span>
    <span class="n">stratum</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;stratid&quot;</span><span class="p">],</span>
    <span class="n">psu</span><span class="o">=</span><span class="n">nhanes2</span><span class="p">[</span><span class="s2">&quot;psuid&quot;</span><span class="p">],</span>
    <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ratio_bp_lead</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Ratio

Number of strata: 31
Number of psus: 62
Degree of freedom: 31

  RATIO       SE     LCI      UCI       CV
5.93255 0.553058 4.80458 7.060519 0.093224
</pre></div></div>
</div>
</div>
<div class="section" id="Replicate-based-variance-estimation">
<h2>Replicate-based variance estimation<a class="headerlink" href="#Replicate-based-variance-estimation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Bootstrap">
<h3>Bootstrap<a class="headerlink" href="#Bootstrap" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load NMIHS sample data</span>
<span class="n">nmihs_cls</span> <span class="o">=</span> <span class="n">Nmihs</span><span class="p">()</span>
<span class="n">nmihs_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">nmihs</span> <span class="o">=</span> <span class="n">nmihs_cls</span><span class="o">.</span><span class="n">data</span>

<span class="n">nmihs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>finalwgt</th>
      <th>birth_weight</th>
      <th>bsrw1</th>
      <th>bsrw2</th>
      <th>bsrw3</th>
      <th>bsrw4</th>
      <th>bsrw5</th>
      <th>bsrw6</th>
      <th>bsrw7</th>
      <th>bsrw8</th>
      <th>...</th>
      <th>bsrw41</th>
      <th>bsrw42</th>
      <th>bsrw43</th>
      <th>bsrw44</th>
      <th>bsrw45</th>
      <th>bsrw46</th>
      <th>bsrw47</th>
      <th>bsrw48</th>
      <th>bsrw49</th>
      <th>bsrw50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.67243</td>
      <td>1270</td>
      <td>49.403603</td>
      <td>0.000000</td>
      <td>49.403603</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>49.403603</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>49.403603</td>
      <td>0.000000</td>
      <td>74.105408</td>
      <td>49.403603</td>
      <td>24.701801</td>
      <td>49.403603</td>
    </tr>
    <tr>
      <th>1</th>
      <td>23.56827</td>
      <td>879</td>
      <td>23.596327</td>
      <td>47.192654</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>...</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>0.000000</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>23.596327</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24.67243</td>
      <td>794</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>24.701801</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>49.403603</td>
      <td>24.701801</td>
      <td>98.807205</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20.33146</td>
      <td>1446</td>
      <td>40.711327</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>40.711327</td>
      <td>20.355663</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>...</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>61.066994</td>
      <td>61.066994</td>
      <td>40.711327</td>
      <td>40.711327</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>81.422653</td>
      <td>40.711327</td>
    </tr>
    <tr>
      <th>4</th>
      <td>21.83328</td>
      <td>830</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>21.859272</td>
      <td>0.000000</td>
      <td>21.859272</td>
      <td>...</td>
      <td>65.577812</td>
      <td>0.000000</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>0.000000</td>
      <td>21.859272</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>23.56827</td>
      <td>1304</td>
      <td>70.788986</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>0.000000</td>
      <td>23.596327</td>
      <td>47.192654</td>
      <td>0.000000</td>
      <td>...</td>
      <td>47.192654</td>
      <td>47.192654</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>0.000000</td>
      <td>23.596327</td>
      <td>23.596327</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>18.67915</td>
      <td>1106</td>
      <td>18.701387</td>
      <td>56.104160</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>0.000000</td>
      <td>...</td>
      <td>18.701387</td>
      <td>0.000000</td>
      <td>18.701387</td>
      <td>0.000000</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>37.402775</td>
    </tr>
    <tr>
      <th>7</th>
      <td>24.63370</td>
      <td>1418</td>
      <td>24.663025</td>
      <td>49.326050</td>
      <td>0.000000</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>24.663025</td>
      <td>...</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>49.326050</td>
      <td>49.326050</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>24.663025</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>20.33146</td>
      <td>1474</td>
      <td>0.000000</td>
      <td>40.711327</td>
      <td>40.711327</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.711327</td>
      <td>...</td>
      <td>40.711327</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
    </tr>
    <tr>
      <th>9</th>
      <td>20.33146</td>
      <td>454</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>61.066994</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.711327</td>
      <td>...</td>
      <td>0.000000</td>
      <td>61.066994</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>81.422653</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>24.67243</td>
      <td>1380</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>24.701801</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>49.403603</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>...</td>
      <td>0.000000</td>
      <td>49.403603</td>
      <td>49.403603</td>
      <td>0.000000</td>
      <td>74.105408</td>
      <td>24.701801</td>
      <td>0.000000</td>
      <td>24.701801</td>
      <td>98.807205</td>
      <td>49.403603</td>
    </tr>
    <tr>
      <th>11</th>
      <td>20.33146</td>
      <td>539</td>
      <td>61.066994</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>40.711327</td>
      <td>40.711327</td>
      <td>...</td>
      <td>20.355663</td>
      <td>40.711327</td>
      <td>20.355663</td>
      <td>40.711327</td>
      <td>61.066994</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>20.355663</td>
      <td>20.355663</td>
      <td>20.355663</td>
    </tr>
    <tr>
      <th>12</th>
      <td>24.63370</td>
      <td>1021</td>
      <td>49.326050</td>
      <td>24.663025</td>
      <td>98.652100</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>73.989075</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>...</td>
      <td>24.663025</td>
      <td>0.000000</td>
      <td>49.326050</td>
      <td>0.000000</td>
      <td>24.663025</td>
      <td>73.989075</td>
      <td>73.989075</td>
      <td>24.663025</td>
      <td>24.663025</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>21.83328</td>
      <td>1049</td>
      <td>65.577812</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>0.000000</td>
      <td>65.577812</td>
      <td>21.859272</td>
      <td>21.859272</td>
      <td>...</td>
      <td>0.000000</td>
      <td>65.577812</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>21.859272</td>
      <td>43.718544</td>
      <td>21.859272</td>
      <td>43.718544</td>
      <td>0.000000</td>
      <td>21.859272</td>
    </tr>
    <tr>
      <th>14</th>
      <td>18.67915</td>
      <td>1134</td>
      <td>0.000000</td>
      <td>18.701387</td>
      <td>37.402775</td>
      <td>0.000000</td>
      <td>37.402775</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>56.104160</td>
      <td>...</td>
      <td>18.701387</td>
      <td>18.701387</td>
      <td>0.000000</td>
      <td>18.701387</td>
      <td>0.000000</td>
      <td>56.104160</td>
      <td>0.000000</td>
      <td>56.104160</td>
      <td>0.000000</td>
      <td>56.104160</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 52 columns</p>
</div></div>
</div>
<p>Let’s estimate the average birth weight using the bootstrap weights.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># rep_wgt_boot = nmihsboot.loc[:, &quot;bsrw1&quot;:&quot;bsrw50&quot;]</span>

<span class="n">birthwgt</span> <span class="o">=</span> <span class="n">ReplicateEstimator</span><span class="p">(</span><span class="s2">&quot;bootstrap&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nmihs</span><span class="p">[</span><span class="s2">&quot;birth_weight&quot;</span><span class="p">],</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">nmihs</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span>
    <span class="n">rep_weights</span><span class="o">=</span><span class="n">nmihs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;bsrw1&quot;</span><span class="p">:</span><span class="s2">&quot;bsrw50&quot;</span><span class="p">],</span>
    <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">birthwgt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Mean

Number of strata: None
Number of psus: None
Degree of freedom: 49

       MEAN        SE         LCI         UCI       CV
2679.127143 31.053792 2616.722212 2741.532074 0.011591
</pre></div></div>
</div>
</div>
<div class="section" id="Balanced-repeated-replication-(BRR)">
<h3>Balanced repeated replication (BRR)<a class="headerlink" href="#Balanced-repeated-replication-(BRR)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load NMIHS sample data</span>
<span class="n">nhanes2brr_cls</span> <span class="o">=</span> <span class="n">Nhanes2brr</span><span class="p">()</span>
<span class="n">nhanes2brr_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">nhanes2brr</span> <span class="o">=</span> <span class="n">nhanes2brr_cls</span><span class="o">.</span><span class="n">data</span>

<span class="n">nhanes2brr</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>height</th>
      <th>weight</th>
      <th>finalwgt</th>
      <th>brr_1</th>
      <th>brr_2</th>
      <th>brr_3</th>
      <th>brr_4</th>
      <th>brr_5</th>
      <th>brr_6</th>
      <th>brr_7</th>
      <th>...</th>
      <th>brr_23</th>
      <th>brr_24</th>
      <th>brr_25</th>
      <th>brr_26</th>
      <th>brr_27</th>
      <th>brr_28</th>
      <th>brr_29</th>
      <th>brr_30</th>
      <th>brr_31</th>
      <th>brr_32</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>174.59801</td>
      <td>62.480000</td>
      <td>8995</td>
      <td>0</td>
      <td>17990</td>
      <td>17990</td>
      <td>0</td>
      <td>17990</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>17990</td>
      <td>0</td>
      <td>0</td>
      <td>17990</td>
      <td>17990</td>
      <td>0</td>
      <td>17990</td>
      <td>0</td>
      <td>0</td>
      <td>17990</td>
    </tr>
    <tr>
      <th>1</th>
      <td>152.29700</td>
      <td>48.759998</td>
      <td>25964</td>
      <td>0</td>
      <td>51928</td>
      <td>51928</td>
      <td>0</td>
      <td>51928</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>51928</td>
      <td>0</td>
      <td>0</td>
      <td>51928</td>
      <td>51928</td>
      <td>0</td>
      <td>51928</td>
      <td>0</td>
      <td>0</td>
      <td>51928</td>
    </tr>
    <tr>
      <th>2</th>
      <td>164.09801</td>
      <td>67.250000</td>
      <td>8752</td>
      <td>0</td>
      <td>17504</td>
      <td>17504</td>
      <td>0</td>
      <td>17504</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>17504</td>
      <td>0</td>
      <td>0</td>
      <td>17504</td>
      <td>17504</td>
      <td>0</td>
      <td>17504</td>
      <td>0</td>
      <td>0</td>
      <td>17504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>162.59801</td>
      <td>94.459999</td>
      <td>4310</td>
      <td>0</td>
      <td>8620</td>
      <td>8620</td>
      <td>0</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>8620</td>
      <td>8620</td>
      <td>0</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>8620</td>
    </tr>
    <tr>
      <th>4</th>
      <td>163.09801</td>
      <td>74.279999</td>
      <td>9011</td>
      <td>0</td>
      <td>18022</td>
      <td>18022</td>
      <td>0</td>
      <td>18022</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>18022</td>
      <td>0</td>
      <td>0</td>
      <td>18022</td>
      <td>18022</td>
      <td>0</td>
      <td>18022</td>
      <td>0</td>
      <td>0</td>
      <td>18022</td>
    </tr>
    <tr>
      <th>5</th>
      <td>147.09801</td>
      <td>66.000000</td>
      <td>4310</td>
      <td>0</td>
      <td>8620</td>
      <td>8620</td>
      <td>0</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>8620</td>
      <td>8620</td>
      <td>0</td>
      <td>8620</td>
      <td>0</td>
      <td>0</td>
      <td>8620</td>
    </tr>
    <tr>
      <th>6</th>
      <td>153.89799</td>
      <td>54.549999</td>
      <td>3201</td>
      <td>0</td>
      <td>6402</td>
      <td>6402</td>
      <td>0</td>
      <td>6402</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>6402</td>
      <td>0</td>
      <td>0</td>
      <td>6402</td>
      <td>6402</td>
      <td>0</td>
      <td>6402</td>
      <td>0</td>
      <td>0</td>
      <td>6402</td>
    </tr>
    <tr>
      <th>7</th>
      <td>160.00000</td>
      <td>58.970001</td>
      <td>25386</td>
      <td>0</td>
      <td>50772</td>
      <td>50772</td>
      <td>0</td>
      <td>50772</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>50772</td>
      <td>0</td>
      <td>0</td>
      <td>50772</td>
      <td>50772</td>
      <td>0</td>
      <td>50772</td>
      <td>0</td>
      <td>0</td>
      <td>50772</td>
    </tr>
    <tr>
      <th>8</th>
      <td>164.00000</td>
      <td>68.949997</td>
      <td>12102</td>
      <td>0</td>
      <td>24204</td>
      <td>24204</td>
      <td>0</td>
      <td>24204</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>24204</td>
      <td>0</td>
      <td>0</td>
      <td>24204</td>
      <td>24204</td>
      <td>0</td>
      <td>24204</td>
      <td>0</td>
      <td>0</td>
      <td>24204</td>
    </tr>
    <tr>
      <th>9</th>
      <td>176.59801</td>
      <td>65.430000</td>
      <td>4312</td>
      <td>0</td>
      <td>8624</td>
      <td>8624</td>
      <td>0</td>
      <td>8624</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8624</td>
      <td>0</td>
      <td>0</td>
      <td>8624</td>
      <td>8624</td>
      <td>0</td>
      <td>8624</td>
      <td>0</td>
      <td>0</td>
      <td>8624</td>
    </tr>
    <tr>
      <th>10</th>
      <td>156.19901</td>
      <td>76.769997</td>
      <td>4031</td>
      <td>0</td>
      <td>8062</td>
      <td>8062</td>
      <td>0</td>
      <td>8062</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8062</td>
      <td>0</td>
      <td>0</td>
      <td>8062</td>
      <td>8062</td>
      <td>0</td>
      <td>8062</td>
      <td>0</td>
      <td>0</td>
      <td>8062</td>
    </tr>
    <tr>
      <th>11</th>
      <td>170.09801</td>
      <td>58.400002</td>
      <td>3628</td>
      <td>0</td>
      <td>7256</td>
      <td>7256</td>
      <td>0</td>
      <td>7256</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7256</td>
      <td>0</td>
      <td>0</td>
      <td>7256</td>
      <td>7256</td>
      <td>0</td>
      <td>7256</td>
      <td>0</td>
      <td>0</td>
      <td>7256</td>
    </tr>
    <tr>
      <th>12</th>
      <td>151.79700</td>
      <td>65.769997</td>
      <td>28590</td>
      <td>0</td>
      <td>57180</td>
      <td>57180</td>
      <td>0</td>
      <td>57180</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>57180</td>
      <td>0</td>
      <td>0</td>
      <td>57180</td>
      <td>57180</td>
      <td>0</td>
      <td>57180</td>
      <td>0</td>
      <td>0</td>
      <td>57180</td>
    </tr>
    <tr>
      <th>13</th>
      <td>154.19901</td>
      <td>48.540001</td>
      <td>22754</td>
      <td>0</td>
      <td>45508</td>
      <td>45508</td>
      <td>0</td>
      <td>45508</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>45508</td>
      <td>0</td>
      <td>0</td>
      <td>45508</td>
      <td>45508</td>
      <td>0</td>
      <td>45508</td>
      <td>0</td>
      <td>0</td>
      <td>45508</td>
    </tr>
    <tr>
      <th>14</th>
      <td>171.09801</td>
      <td>73.029999</td>
      <td>7119</td>
      <td>0</td>
      <td>14238</td>
      <td>14238</td>
      <td>0</td>
      <td>14238</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>14238</td>
      <td>0</td>
      <td>0</td>
      <td>14238</td>
      <td>14238</td>
      <td>0</td>
      <td>14238</td>
      <td>0</td>
      <td>0</td>
      <td>14238</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 35 columns</p>
</div></div>
</div>
<p>Let’s estimate the average birth weight using the BRR weights.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">brr</span> <span class="o">=</span> <span class="n">ReplicateEstimator</span><span class="p">(</span><span class="s2">&quot;brr&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">)</span>

<span class="n">ratio_wgt_hgt</span> <span class="o">=</span> <span class="n">brr</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nhanes2brr</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">nhanes2brr</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="n">nhanes2brr</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
    <span class="n">rep_weights</span><span class="o">=</span><span class="n">nhanes2brr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;brr_1&quot;</span><span class="p">:</span><span class="s2">&quot;brr_32&quot;</span><span class="p">],</span>
    <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ratio_wgt_hgt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Ratio

Number of strata: None
Number of psus: None
Degree of freedom: 16

   RATIO      SE      LCI     UCI       CV
0.426082 0.00273 0.420295 0.43187 0.006407
</pre></div></div>
</div>
</div>
<div class="section" id="Jackknife">
<h3>Jackknife<a class="headerlink" href="#Jackknife" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load NMIHS sample data</span>
<span class="n">nhanes2jk_cls</span> <span class="o">=</span> <span class="n">Nhanes2jk</span><span class="p">()</span>
<span class="n">nhanes2jk_cls</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">nhanes2jk</span> <span class="o">=</span> <span class="n">nhanes2jk_cls</span><span class="o">.</span><span class="n">data</span>

<span class="n">nhanes2jk</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>height</th>
      <th>weight</th>
      <th>finalwgt</th>
      <th>jkw_1</th>
      <th>jkw_2</th>
      <th>jkw_3</th>
      <th>jkw_4</th>
      <th>jkw_5</th>
      <th>jkw_6</th>
      <th>jkw_7</th>
      <th>...</th>
      <th>jkw_53</th>
      <th>jkw_54</th>
      <th>jkw_55</th>
      <th>jkw_56</th>
      <th>jkw_57</th>
      <th>jkw_58</th>
      <th>jkw_59</th>
      <th>jkw_60</th>
      <th>jkw_61</th>
      <th>jkw_62</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>174.59801</td>
      <td>62.480000</td>
      <td>8995</td>
      <td>0</td>
      <td>17990</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>...</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
      <td>8995</td>
    </tr>
    <tr>
      <th>1</th>
      <td>152.29700</td>
      <td>48.759998</td>
      <td>25964</td>
      <td>0</td>
      <td>51928</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>...</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
      <td>25964</td>
    </tr>
    <tr>
      <th>2</th>
      <td>164.09801</td>
      <td>67.250000</td>
      <td>8752</td>
      <td>0</td>
      <td>17504</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>...</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
      <td>8752</td>
    </tr>
    <tr>
      <th>3</th>
      <td>162.59801</td>
      <td>94.459999</td>
      <td>4310</td>
      <td>0</td>
      <td>8620</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>...</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
    </tr>
    <tr>
      <th>4</th>
      <td>163.09801</td>
      <td>74.279999</td>
      <td>9011</td>
      <td>0</td>
      <td>18022</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>...</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
      <td>9011</td>
    </tr>
    <tr>
      <th>5</th>
      <td>147.09801</td>
      <td>66.000000</td>
      <td>4310</td>
      <td>0</td>
      <td>8620</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>...</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
      <td>4310</td>
    </tr>
    <tr>
      <th>6</th>
      <td>153.89799</td>
      <td>54.549999</td>
      <td>3201</td>
      <td>0</td>
      <td>6402</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>...</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
      <td>3201</td>
    </tr>
    <tr>
      <th>7</th>
      <td>160.00000</td>
      <td>58.970001</td>
      <td>25386</td>
      <td>0</td>
      <td>50772</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>...</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
      <td>25386</td>
    </tr>
    <tr>
      <th>8</th>
      <td>164.00000</td>
      <td>68.949997</td>
      <td>12102</td>
      <td>0</td>
      <td>24204</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>...</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
      <td>12102</td>
    </tr>
    <tr>
      <th>9</th>
      <td>176.59801</td>
      <td>65.430000</td>
      <td>4312</td>
      <td>0</td>
      <td>8624</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>...</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
      <td>4312</td>
    </tr>
    <tr>
      <th>10</th>
      <td>156.19901</td>
      <td>76.769997</td>
      <td>4031</td>
      <td>0</td>
      <td>8062</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>...</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
      <td>4031</td>
    </tr>
    <tr>
      <th>11</th>
      <td>156.69901</td>
      <td>57.040001</td>
      <td>3813</td>
      <td>7626</td>
      <td>0</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>...</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
      <td>3813</td>
    </tr>
    <tr>
      <th>12</th>
      <td>182.00000</td>
      <td>99.110001</td>
      <td>7445</td>
      <td>14890</td>
      <td>0</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>...</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
      <td>7445</td>
    </tr>
    <tr>
      <th>13</th>
      <td>158.29700</td>
      <td>84.480003</td>
      <td>3528</td>
      <td>7056</td>
      <td>0</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>...</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
      <td>3528</td>
    </tr>
    <tr>
      <th>14</th>
      <td>152.89799</td>
      <td>70.309998</td>
      <td>7790</td>
      <td>15580</td>
      <td>0</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>...</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
      <td>7790</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 65 columns</p>
</div></div>
</div>
<p>In this case, stratification was used to calculate the jackknife weights. The stratum variable is not indicated in the dataset or survey design description. However, it says that the number of strata is 31 and the number of replicates is 62. Hence, the jackknife replicate coefficient is <span class="math notranslate nohighlight">\((n_h - 1) / n_h = (2-1) / 2 = 0.5\)</span>. Now we can call <em>replicate()</em> and specify <em>rep_coefs = 0.5</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">jackknife</span> <span class="o">=</span> <span class="n">ReplicateEstimator</span><span class="p">(</span><span class="s2">&quot;jackknife&quot;</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">)</span>

<span class="n">ratio_wgt_hgt2</span> <span class="o">=</span> <span class="n">jackknife</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="n">nhanes2jk</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span>
    <span class="n">samp_weight</span><span class="o">=</span><span class="n">nhanes2jk</span><span class="p">[</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">],</span>
    <span class="n">x</span><span class="o">=</span><span class="n">nhanes2jk</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
    <span class="n">rep_weights</span><span class="o">=</span><span class="n">nhanes2jk</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;jkw_1&quot;</span><span class="p">:</span><span class="s2">&quot;jkw_62&quot;</span><span class="p">],</span>
    <span class="n">rep_coefs</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">remove_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ratio_wgt_hgt2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SAMPLICS - Estimation of Ratio

Number of strata: None
Number of psus: None
Degree of freedom: 61

   RATIO       SE      LCI      UCI      CV
0.423502 0.003464 0.416574 0.430429 0.00818
</pre></div></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019-2020, samplics.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>